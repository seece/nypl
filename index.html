<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nypl Programming Language Online Interpreter - NPLOI</title>
    <script src="web.js"></script>
    <style>
    input {
      font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;
    }
    #words {
      font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;
    }
    #content {
        max-width:680px;
        margin-left:auto;
        margin-right:auto;
    }
    img {
        display: block;
        margin: 0 auto;
        margin-top: 5%;
        margin-bottom: 1%;
    }
    </style>
</head>
<body>
<div id="content">
    <center><h1>Nypl</h1></center>
    <img src="kyber.gif" alt="EMBRACE THE FUTURE"></img>
    <center><i>Embrace the future of programming.</i></center>
    <br>
See the <a href="https://github.com/seece/nypl/blob/master/readme.md">The Language Guide</a> for usage.<br>
<div id='words'></div>
<label for="stackdebug">Show stack stages </label><input id="stackdebug" type="checkbox" checked="checked"></input>
<br><label>Share: </label><input id='url' size="80" width="100%" type="text" onfocus="javascript:updateURL();"></input>
<br>
<br>
<textarea id='output' rows="24" cols="90" readonly></textarea>
<br>
<input id='entry' size="80" width="100%" type="text" value="5 4 +" autofocus></input>
<button id='run' onclick="javascript:run();">Run</button>
<button id='clear' onclick="javascript:clearOutput();">Clear</button>
    <script>
    "use strict";
    function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
    var entry = document.getElementById('entry');
    var out = document.getElementById('output');
    var urlBox = document.getElementById('url');
    var wordBox = document.getElementById('words');
    var stackDebugCheckbox = document.getElementById('stackdebug');
    var words = {};

    var updateWords = function () {
        wordBox.innerHTML = "Words: " + Object.keys(words).toString().replace(/,/g, " ");
    }

    var source = getParameterByName("c");
    if (source !== null) {
        entry.value = source;
    }
    var showStages = getParameterByName("s");
    if (showStages !== null) {
        stackDebugCheckbox.checked = (showStages === "1");
    }

    var getURL = function (code, showStack) {
        var s = location.protocol + '//' + location.host + location.pathname;
        return s + "?c="+encodeURIComponent(code) + "&s=" + (showStack ? "1" : "0") ;
    }

    function updateURL() {
        urlBox.value = getURL(entry.value, stackDebugCheckbox.checked);
    }

    var run = function () {
        var src = entry.value;
        updateURL();
        var add = (msg) => {
            out.value += msg + "\n";
            out.scrollTop = out.scrollHeight;
        };

        add("> "+src);
        var output = (msg) => {};
        if (stackDebugCheckbox.checked) {
            output = add;
        }
        try {
            var result = window.nypl.run(src, add, output, words, []);
            add(">> " + result);
        } catch(ex) {
            add(ex.toString().toUpperCase());
        }

        updateWords();
    }

    run();

    var clearOutput = function () {
        out.value = "";
    }

    document.getElementById('entry').onkeypress=function(e){
        if(e.keyCode==13){
            run();
        }
    }
    </script>
</div>
</body>
</html>
